<!DOCTYPE html>

<html>
<head>
<title>LightGBMè¶…å…¥é–€ï¼äºˆæ¸¬åŠ›ã‚¢ãƒƒãƒ—ã®ç§˜è¨£âœ¨</title>
<link href="../styles/styles.css" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<style>
    <style>
    body {
        font-family: system-ui, -apple-system, sans-serif;
        max-width: 900px;
        margin: 0 auto;
        background: #f8fafc;
        padding: 2rem;
    }
    .container {
        background: white;
        border-radius: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        position: relative;
    }
    .sidebar-toggle {
        position: absolute;
        top: 1rem;
        right: 1rem;
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 0.5rem;
        background: white;
        border: 1px solid #e2e8f0;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        z-index: 1001;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .sidebar-toggle:hover {
        background: #f1f5f9;
        transform: translateY(-1px);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    }
    .sidebar-toggle.active {
        background: #f1f5f9;
        transform: translateX(-250px);
    }
    .sidebar {
        position: absolute;
        top: 0;
        right: 0;
        width: 250px;
        height: 100%;
        background: #f1f5f9;
        border-left: 1px solid #e2e8f0;
        padding: 1rem;
        padding-top: 4rem;
        box-sizing: border-box;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        z-index: 1000;
        box-shadow: -2px 0 4px rgba(0, 0, 0, 0.1);
    }
    .sidebar.open {
        transform: translateX(0);
    }
    .sidebar-content {
        height: 100%;
        overflow-y: auto;
    }
    .sidebar-item {
        display: block;
        padding: 0.75rem 1rem;
        color: #475569;
        text-decoration: none;
        transition: all 0.2s ease;
        border-radius: 0.375rem;
        margin-bottom: 0.25rem;
        font-size: 0.95rem;
    }
    .sidebar-item:hover {
        background: white;
        color: #1d4ed8;
        transform: translateX(4px);
    }
    .back-button {
        position: absolute;
        top: 1rem;
        left: 1rem;
        height: 2.5rem;
        padding: 0 1rem;
        border-radius: 0.5rem;
        background: white;
        border: 1px solid #e2e8f0;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.95rem;
        z-index: 1001;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        color: #475569;
        text-decoration: none;
    }
    .back-button:hover {
        background: #f1f5f9;
        transform: translateY(-1px);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        color: #1d4ed8;
    }
    .back-button span {
        margin-right: 0.5rem;
    }
    </style>
</head>
<body>
<div class="container">
<div class="header">
<h1>2.4 LightGBMã§äºˆæ¸¬åŠ›ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼ğŸš€</h1>
<p>å‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã§äºˆæ¸¬ç²¾åº¦ãƒã‚¸ã‚¢ãƒƒãƒ—ï¼SHAPã§è§£é‡ˆã‚‚ãƒãƒƒãƒãƒªï¼</p>
</div>
<div class="content">
<div class="card">
<h2>ğŸ’« å‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã£ã¦ãªã«ï¼Ÿ</h2>
<div class="feature">
<p>è¤‡æ•°ã®æ±ºå®šæœ¨ã‚’ãƒãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ã•ã›ã¦ã€äºˆæ¸¬ç²¾åº¦ã‚’ã©ã‚“ã©ã‚“ä¸Šã’ã¦ã„ãæ–¹æ³•ã ã‚ˆï¼âœ¨</p>
<div class="formula">
<div class="formula-main">
            \[\hat{y} = \hat{y}^{(0)} + \sum_{k=1}^K w_k(\mathbf{x})\]
          </div>
<div class="formula-explanation">
            äºˆæ¸¬å€¤ã¯åˆæœŸå€¤ã«ã€Kå€‹ã®æœ¨ã®äºˆæ¸¬å€¤ã‚’è¶³ã—åˆã‚ã›ãŸã‚‚ã®ã«ãªã‚‹ã®ï¼å„æœ¨ãŒã¡ã‚‡ã£ã¨ãšã¤äºˆæ¸¬ã‚’è‰¯ãã—ã¦ã„ãã‚¤ãƒ¡ãƒ¼ã‚¸ï¼
          </div>
</div>
</div>
<div class="tip">
<h4>ğŸŒˆ LightGBMã®ã„ã„ã¨ã“ã‚</h4>
<ul>
<li>äºˆæ¸¬ç²¾åº¦ãŒé«˜ã„ï¼è¤‡æ•°ã®æœ¨ãŒå”åŠ›ã™ã‚‹ã‹ã‚‰ï¼</li>
<li>å­¦ç¿’ãŒè¶…é€Ÿã„ï¼ã ã‹ã‚‰ã€ŒLightã€ã£ã¦åå‰ãŒã¤ã„ã¦ã‚‹ã®ï¼</li>
<li>å¤§ããªãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã§ã‚‚ä½™è£•ã§æ‰±ãˆã‚‹ï¼</li>
</ul>
</div>
</div>
<div class="card">
<h2>ğŸ¯ å®Ÿè·µç·¨ï¼šBostonãƒã‚¦ã‚¹ãƒ—ãƒ©ã‚¤ã‚¹äºˆæ¸¬</h2>
<div class="feature">
<h3>ã¾ãšã¯ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™ã‹ã‚‰ï¼</h3>
<div class="code code-python">
<span class="comment"># å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼âœ¨</span>
<span class="keyword">import</span> <span class="builtin">lightgbm</span> <span class="keyword">as</span> lgb
<span class="keyword">import</span> <span class="builtin">pandas</span> <span class="keyword">as</span> pd

<span class="comment"># ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã‚’èª­ã¿è¾¼ã‚€ã‚ˆï¼</span>
df = pd.read_csv(<span class="string">'housing.data'</span>)
        </div>
</div>
<div class="success">
<h4>ğŸ’ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šã®ã‚³ãƒ„ï¼</h4>
<p>ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¨­å®šã§ãƒ¢ãƒ‡ãƒ«ã®æ€§èƒ½ãŒå¤‰ã‚ã‚‹ã‚ˆï¼</p>
<div class="code code-python">
params = {
    <span class="string">'objective'</span>: <span class="string">'regression'</span>,  <span class="comment"># å›å¸°å•é¡Œã ã‚ˆï¼</span>
<span class="string">'metric'</span>: <span class="string">'rmse'</span>,          <span class="comment"># è©•ä¾¡æŒ‡æ¨™ã¯RMSEï¼</span>
<span class="string">'learning_rate'</span>: 0.1,    <span class="comment"># å­¦ç¿’ç‡ã¯0.1ã«è¨­å®š</span>
<span class="string">'num_leaves'</span>: 31,        <span class="comment"># è‘‰ã®æ•°ã¯31æšã¾ã§ï¼</span>
<span class="string">'min_data_in_leaf'</span>: 20,  <span class="comment"># è‘‰ã”ã¨ã®æœ€å°ãƒ‡ãƒ¼ã‚¿æ•°</span>
}
        </div>
</div>
</div>
<div class="card">
<h2>âœ¨ SHAPã§äºˆæ¸¬ã®è§£é‡ˆåŠ›ã‚¢ãƒƒãƒ—ï¼</h2>
<div class="feature">
<p>SHAPã‚’ä½¿ã†ã¨ã€äºˆæ¸¬ãŒãªãœãã†ãªã£ãŸã®ã‹è¶…åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜ã§ãã‚‹ã®ï¼</p>
<div class="code code-python">
<span class="comment"># SHAPã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</span>
!pip install shap

<span class="comment"># SHAPã§äºˆæ¸¬ã‚’è§£é‡ˆï¼</span>
<span class="keyword">import</span> <span class="builtin">shap</span>
explainer = shap.TreeExplainer(model)
shap_values = explainer(X_test)
        </div>
</div>
<div class="warning">
<h4>âš ï¸ æ°—ã‚’ã¤ã‘ãƒã‚¤ãƒ³ãƒˆï¼</h4>
<p>SHAPã¯è¨ˆç®—ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã“ã¨ãŒã‚ã‚‹ã‹ã‚‰ã€å°ã•ãªã‚µãƒ³ãƒ—ãƒ«ã§ã¾ãšè©¦ã—ã¦ã¿ã‚‹ã®ãŒãŠã™ã™ã‚ï¼</p>
</div>
</div>
<div class="card">
<h2>ğŸ“Š å¯è¦–åŒ–ã§ç†è§£ã‚’æ·±ã‚ã‚ˆã†ï¼</h2>
<div class="feature">
<h3>SHAP Waterfall Plotã§äºˆæ¸¬ã®ç†ç”±ã‚’è§£æ˜ï¼</h3>
<div class="code code-python">
<span class="comment"># ç‰¹å®šã®ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã®äºˆæ¸¬ã‚’è§£é‡ˆ</span>
shap.plots.waterfall(shap_values[0])
        </div>
</div>
<div class="success">
<h4>ğŸ’« å¯è¦–åŒ–ã®ãƒã‚¤ãƒ³ãƒˆ</h4>
<ul>
<li>æ£’ã‚°ãƒ©ãƒ•ã®é•·ã•ã¯ç‰¹å¾´é‡ã®é‡è¦åº¦ã‚’è¡¨ã—ã¦ã‚‹ã‚ˆï¼</li>
<li>èµ¤ã¯æ­£ã®å½±éŸ¿ã€é’ã¯è² ã®å½±éŸ¿ã‚’ç¤ºã™ã®ï¼</li>
<li>ä¸Šã‹ã‚‰é †ã«å½±éŸ¿ãŒå¤§ãã„é †ã«ä¸¦ã‚“ã§ã‚‹ã‚ˆï¼</li>
</ul>
</div>
</div>
</div>

<a class="back-button" href="../index.html">
<span>â†</span> ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    </a>

<button class="sidebar-toggle" id="sidebarToggle">
<span>ğŸ“‘</span>
</button>
<div class="sidebar" id="sidebar">
<nav class="sidebar-content">
<a class="sidebar-item" href="1-1.html">1.1 äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«å…¥é–€ï¼âœ¨</a>
<a class="sidebar-item" href="1-2.html">1.2 æ©Ÿæ¢°å­¦ç¿’ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã‚ˆã†ï¼ğŸ®</a>
<a class="sidebar-item" href="1-3.html">1.3 ç’°å¢ƒæ§‹ç¯‰ã‚„ã£ã¦ã¿ã‚ˆï½ï¼ğŸŒˆ</a>
<a class="sidebar-item" href="2-1.html">2-1 ãƒ‡ãƒ¼ã‚¿åˆ†æã®ãƒ‡ã‚£ãƒ¼ãƒ—ãªä¸–ç•Œã¸ã‚ˆã†ã“ãï¼ğŸŒŸ</a>
<a class="sidebar-item" href="2-2.html">2.2 ç·šå½¢å›å¸°ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¡ã‚ƒãŠï¼ğŸŒˆ</a>
<a class="sidebar-item" href="2-3.html">2.3 å›å¸°æœ¨ã§äºˆæ¸¬åŠ›ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼ğŸŒŸ</a>
<a class="sidebar-item" href="2-4.html">2.4 LightGBMã§äºˆæ¸¬åŠ›ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼ğŸš€</a>
<a class="sidebar-item" href="3-1.html">3.1 ãƒ‡ãƒ¼ã‚¿ç†è§£ã—ã¦ã¿ã‚ˆã†ï¼ğŸŒˆ</a>
</nav>
</div>
<script>
        document.getElementById("sidebarToggle").addEventListener("click", function() {
            const sidebar = document.getElementById("sidebar");
            sidebar.classList.toggle("open");
            this.classList.toggle("active");
        });
    </script>
</div>
<div class="container">
<div class="card">
<h2>ğŸŒŸ ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’ã‚’å§‹ã‚ã‚ˆã†ï¼</h2>
<div class="feature">
<p>ã¾ãšã¯ãƒ‡ãƒ¼ã‚¿ã‚’å­¦ç¿’ç”¨ã¨ãƒ†ã‚¹ãƒˆç”¨ã«åˆ†ã‘ã‚‹ã‚ˆï¼8:2ã®é»„é‡‘æ¯”ã ã‚ˆï¼âœ¨</p>
<div class="code code-python">
<span class="comment"># ãƒ‡ãƒ¼ã‚¿æº–å‚™</span>
  X_train, X_test, y_train, y_test = train_test_split(X, y, 
      test_size=0.2, random_state=42)
  
  <span class="comment"># LightGBMç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆä½œæˆ</span>
  lgb_train = lgb.Dataset(X_train, y_train)
  lgb_eval = lgb.Dataset(X_test, y_test, reference=lgb_train)
        </div>
<div class="tip">
<h4>ğŸ’¡ ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆä½œæˆã®ã‚³ãƒ„</h4>
<p>referenceã‚’æŒ‡å®šã™ã‚‹ã¨ã€å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã¨åŒã˜å‰å‡¦ç†ãŒè©•ä¾¡ãƒ‡ãƒ¼ã‚¿ã«ã‚‚é©ç”¨ã•ã‚Œã‚‹ã®ï¼ã“ã‚Œè¶…é‡è¦ï¼</p>
</div>
</div>
</div>
<div class="card">
<h2>ğŸ® å­¦ç¿’ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šï¼</h2>
<div class="feature">
<p>ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®è¨­å®šã§ãƒ¢ãƒ‡ãƒ«ã®æ€§èƒ½ãŒå¤‰ã‚ã‚‹ã‚ˆï¼</p>
<div class="code code-python">
  params = {
      <span class="string">'objective'</span>: <span class="string">'regression'</span>,     
      <span class="string">'metric'</span>: <span class="string">'rmse'</span>,            
      <span class="string">'learning_rate'</span>: 0.8,       <span class="comment"># å­¦ç¿’ç‡é«˜ã‚ã«è¨­å®šï¼</span>
<span class="string">'num_leaves'</span>: 5,            <span class="comment"># è‘‰ã®æ•°ã¯æ§ãˆã‚ã«</span>
<span class="string">'min_data_in_leaf'</span>: 1,      <span class="comment"># æœ€å°ãƒ‡ãƒ¼ã‚¿æ•°</span>
<span class="string">'max_bin'</span>: 100              <span class="comment"># ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã®binæ•°</span>
  }
        </div>
<div class="warning">
<h4>âš ï¸ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ã®æ³¨æ„ç‚¹</h4>
<ul>
<li>learning_rateã¯å°ã•ã„ã¨å­¦ç¿’ãŒé…ã„ã‘ã©å®‰å®šã™ã‚‹ã‚ˆï¼</li>
<li>num_leavesã‚’å¤§ããã—ã™ãã‚‹ã¨éå­¦ç¿’ã®å±é™ºãŒï¼</li>
<li>min_data_in_leafã¯éå­¦ç¿’é˜²æ­¢ã«é‡è¦ï¼</li>
</ul>
</div>
</div>
</div>
<div class="card">
<h2>ğŸƒâ€â™€ï¸ ãƒ¢ãƒ‡ãƒ«ã‚’å­¦ç¿’ã•ã›ã‚ˆã†ï¼</h2>
<div class="feature">
<p>ã„ã‚ˆã„ã‚ˆå­¦ç¿’é–‹å§‹ï¼é€”ä¸­çµŒéã‚‚è¦‹ãªãŒã‚‰é€²ã‚ã‚‹ã‚ˆï¼</p>
<div class="code code-python">
<span class="comment"># ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’ã‚¹ã‚¿ãƒ¼ãƒˆï¼</span>
  model = lgb.train(params,
      lgb_train,
      num_boost_round=50,           <span class="comment"># ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã®å›æ•°</span>
      valid_sets=[lgb_train],       <span class="comment"># è©•ä¾¡ç”¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ</span>
      valid_names=[<span class="string">'train'</span>],     <span class="comment"># ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®åå‰</span>
      callbacks=[lgb.log_evaluation(10)])  <span class="comment"># 10å›ã”ã¨ã«ãƒ­ã‚°ã‚’å‡ºåŠ›</span>
</div>
<div class="success">
<h4>âœ¨ å­¦ç¿’ã®ãƒã‚¤ãƒ³ãƒˆ</h4>
<p>num_boost_roundã¯å¤šã„ã»ã©ç²¾åº¦ãŒä¸ŠãŒã‚‹ã‘ã©ã€éå­¦ç¿’ã«ã‚‚æ³¨æ„ï¼</p>
</div>
</div>
</div>
<div class="card">
<h2>ğŸ“Š äºˆæ¸¬ã¨è©•ä¾¡ã‚’ã—ã¦ã¿ã‚ˆã†ï¼</h2>
<div class="feature">
<h3>äºˆæ¸¬ã—ã¦RMSEã§è©•ä¾¡ï¼</h3>
<div class="code code-python">
<span class="comment"># äºˆæ¸¬å®Ÿè¡Œ</span>
  y_pred = model.predict(X_test)
  
  <span class="comment"># RMSEã§è©•ä¾¡</span>
  rmse = np.sqrt(mean_squared_error(y_test, y_pred))
  print(f<span class="string">'RMSE: {rmse:.2f}'</span>)
        </div>
</div>
<div class="tip">
<h4>ğŸ’« äºˆæ¸¬çµæœã®è§£é‡ˆã®ã‚³ãƒ„</h4>
<ul>
<li>RMSEã¯å°ã•ã„ã»ã©äºˆæ¸¬ãŒå½“ãŸã£ã¦ã‚‹ï¼</li>
<li>å®Ÿéš›ã®å€¤ã¨ã®å·®ã‚’è¦‹ã¦ã€å‚¾å‘ã‚’æŠŠæ¡ã—ã‚ˆã†ï¼</li>
<li>å¤–ã‚Œå€¤ã«ã‚‚æ³¨ç›®ï¼ãƒ¢ãƒ‡ãƒ«ã®é™ç•Œã‚’çŸ¥ã‚‹ã®ã«é‡è¦ï¼</li>
</ul>
</div>
</div>
<div class="card">
<h2>ğŸ” ç‰¹å¾´é‡ã®é‡è¦åº¦ã‚’ç¢ºèªï¼</h2>
<div class="feature">
<p>ã©ã®ç‰¹å¾´é‡ãŒäºˆæ¸¬ã«åŠ¹ã„ã¦ã„ã‚‹ã‹è¦‹ã¦ã¿ã‚ˆã†ï¼</p>
<div class="code code-python">
<span class="comment"># ç‰¹å¾´é‡ã®é‡è¦åº¦ã‚’å¯è¦–åŒ–</span>
  importance = pd.DataFrame({
      <span class="string">'feature'</span>: X.columns,
      <span class="string">'importance'</span>: model.feature_importance(<span class="string">'gain'</span>)
  })
  importance = importance.sort_values(<span class="string">'importance'</span>, ascending=False)
  
  <span class="comment"># ãƒ—ãƒ­ãƒƒãƒˆä½œæˆ</span>
  plt.figure(figsize=(10, 6))
  plt.bar(importance[<span class="string">'feature'</span>], importance[<span class="string">'importance'</span>])
  plt.xticks(rotation=45)
  plt.title(<span class="string">'Feature Importance (Gain)'</span>)
  plt.show()
        </div>
</div>
<div class="success">
<h4>ğŸ“ˆ å¯è¦–åŒ–ã®ãƒã‚¤ãƒ³ãƒˆ</h4>
<ul>
<li>gainã¯ç‰¹å¾´é‡ãŒã©ã‚Œã ã‘æå¤±ã‚’æ¸›ã‚‰ã—ãŸã‹ã‚’è¡¨ã™ã‚ˆï¼</li>
<li>ä¸Šä½ã®ç‰¹å¾´é‡ã«æ³¨ç›®ã—ã¦ã€ãƒ¢ãƒ‡ãƒ«ã®åˆ¤æ–­åŸºæº–ã‚’ç†è§£ã—ã‚ˆã†ï¼</li>
<li>é‡è¦åº¦ã®ä½ã„ç‰¹å¾´é‡ã¯é™¤å¤–ã‚’æ¤œè¨ã—ã¦ã‚‚ã„ã„ã‹ã‚‚ï¼</li>
</ul>
</div>
</div>
</div>
</body>
</html>