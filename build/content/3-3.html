<!DOCTYPE html>

<html>
<head>
<title>3.3 LightGBMåˆ†é¡è¶…å…¥é–€ï¼âœ¨</title>
<link href="../styles/styles.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<style>
    <style>
    body {
        font-family: system-ui, -apple-system, sans-serif;
        max-width: 900px;
        margin: 0 auto;
        background: #f8fafc;
        padding: 2rem;
    }
    .container {
        background: white;
        border-radius: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        position: relative;
    }
    .sidebar-toggle {
        position: absolute;
        top: 1rem;
        right: 1rem;
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 0.5rem;
        background: white;
        border: 1px solid #e2e8f0;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        z-index: 1001;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .sidebar-toggle:hover {
        background: #f1f5f9;
        transform: translateY(-1px);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
    }
    .sidebar-toggle.active {
        background: #f1f5f9;
        transform: translateX(-250px);
    }
    .sidebar {
        position: absolute;
        top: 0;
        right: 0;
        width: 250px;
        height: 100%;
        background: #f1f5f9;
        border-left: 1px solid #e2e8f0;
        padding: 1rem;
        padding-top: 4rem;
        box-sizing: border-box;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        z-index: 1000;
        box-shadow: -2px 0 4px rgba(0, 0, 0, 0.1);
    }
    .sidebar.open {
        transform: translateX(0);
    }
    .sidebar-content {
        height: 100%;
        overflow-y: auto;
    }
    .sidebar-item {
        display: block;
        padding: 0.75rem 1rem;
        color: #475569;
        text-decoration: none;
        transition: all 0.2s ease;
        border-radius: 0.375rem;
        margin-bottom: 0.25rem;
        font-size: 0.95rem;
    }
    .sidebar-item:hover {
        background: white;
        color: #1d4ed8;
        transform: translateX(4px);
    }
    .back-button {
        position: absolute;
        top: 1rem;
        left: 1rem;
        height: 2.5rem;
        padding: 0 1rem;
        border-radius: 0.5rem;
        background: white;
        border: 1px solid #e2e8f0;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.95rem;
        z-index: 1001;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        color: #475569;
        text-decoration: none;
    }
    .back-button:hover {
        background: #f1f5f9;
        transform: translateY(-1px);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        color: #1d4ed8;
    }
    .back-button span {
        margin-right: 0.5rem;
    }
    </style>
</head>
<body>
<div class="container">
<div class="header">
<h1>3.3 LightGBMåˆ†é¡ã§ãƒã‚¸äºˆæ¸¬ï¼âœ¨</h1>
<p>å‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã¨äºˆæ¸¬ã®è§£é‡ˆã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¡ã‚ƒãŠã†ï¼ğŸ’•</p>
</div>
<div class="content">
<!-- ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ è§£èª¬ -->
<div class="card">
<h2>ğŸ’« å‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°åˆ†é¡ã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ </h2>
<div class="feature">
<p>2.4ç¯€ã®å‹¾é…ãƒ–ãƒ¼ã‚¹ãƒ†ã‚£ãƒ³ã‚°å›å¸°ã¨3.2ç¯€ã®ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°ã‚’çµ„ã¿åˆã‚ã›ãŸè¶…ãƒ‘ãƒ¯ãƒ•ãƒ«ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã ã‚ˆï¼<br/>ã¾ãšã¯ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®åŸºæœ¬ã‚’ãƒãƒƒãƒãƒªç†è§£ã—ã¡ã‚ƒãŠï¼âœ¨</p>
<div class="formula">
<div class="formula-main">
              äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã®å¼ã¯ã“ã‚“ãªæ„Ÿã˜ï¼ï¼š
              \[ \hat{y} = \hat{y}^{(0)} + \sum_{k=1}^K w_k(\mathbf{x}) \]  
            </div>
</div>
<div class="formula">
<div class="formula-main">            
              ç¢ºç‡ã«å¤‰æ›ã™ã‚‹ã‚·ã‚°ãƒ¢ã‚¤ãƒ‰é–¢æ•°ï¼š
              \[ \sigma(x) = \frac{1}{1+\exp(-x)} \]
            </div>
</div>
<div class="tip">
<h4>ğŸŒŸ ãƒã‚¤ãƒ³ãƒˆ</h4>
<ul>
<li>åˆæœŸå€¤ã‹ã‚‰å¾ã€…ã«äºˆæ¸¬ã‚’è‰¯ãã—ã¦ã„ãã®ï¼</li>
<li>ã‚·ã‚°ãƒ¢ã‚¤ãƒ‰é–¢æ•°ã§0~1ã®ç¢ºç‡ã«å¤‰æ›ï¼</li>
<li>æœ¨ã‚’500æœ¬ã‚‚ä½œã£ã¡ã‚ƒã†ï¼ã™ã”ããªã„ï¼Ÿâœ¨</li>
</ul>
</div>
</div>
</div>
<!-- å®Ÿè£…ç·¨ -->
<div class="card">
<h2>ğŸ‘©â€ğŸ’» LightGBMã§å­¦ç¿’â†’äºˆæ¸¬â†’è©•ä¾¡ã‚„ã£ã¦ã¿ã‚ˆã†ï¼</h2>
<div class="feature">
<div class="code code-python">
# ã¾ãšã¯ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ï¼
X = df.drop(['income'], axis=1)
y = df['income']

# å­¦ç¿’ç”¨ã¨ãƒ†ã‚¹ãƒˆç”¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†å‰²ï¼
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, shuffle=True, stratify=y, random_state=0)

# ã‚«ãƒ†ã‚´ãƒªå¤‰æ•°ã‚’label encodingã§æ•°å€¤ã«å¤‰æ›ï¼
for c in cat_cols:
    le = LabelEncoder()
    le.fit(X_train[c])
    X_train[c] = le.transform(X_train[c])
    X_test[c] = le.transform(X_test[c])
          </div>
<div class="success">
<h4>ğŸ’ å‰å‡¦ç†ã®ãƒã‚¤ãƒ³ãƒˆï¼</h4>
<ul>
<li>ã‚«ãƒ†ã‚´ãƒªå¤‰æ•°ã¯æ•°å€¤ã«å¤‰æ›ã—ãªãã‚ƒï¼</li>
<li>LightGBMã¯categoryå‹ãŒä½¿ãˆã‚‹ã‘ã©ã€ä»Šå›ã¯SHAPã®ãŸã‚ã«æ•°å€¤å¤‰æ›ã™ã‚‹ã‚ˆï¼</li>
</ul>
</div>
</div>
</div>
<!-- ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ -->
<div class="card">
<h2>âš¡ ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¨­å®šã—ã‚ˆã†ï¼</h2>
<div class="feature">
<p>LightGBMã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯å…¨éƒ¨ã§9å€‹ï¼ãã‚Œãã‚Œã®æ„å‘³ã‚’ã—ã£ã‹ã‚Šç†è§£ã—ã‚ˆã†ï¼âœ¨</p>
<div class="success">
<h4>ğŸ’« ä¸»ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŸã¡</h4>
<table>
<tr>
<th>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</th>
<th>åˆæœŸå€¤</th>
<th>èª¬æ˜</th>
</tr>
<tr>
<td>objective</td>
<td>'regression'</td>
<td>æå¤±é–¢æ•°ã®ç¨®é¡ï¼åˆ†é¡ã¨å›å¸°ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ï¼</td>
</tr>
<tr>
<td>num_leaves</td>
<td>31</td>
<td>è‘‰ã®æœ€å¤§æ•°ï¼å¤šã„ã¨éå­¦ç¿’ã—ã¡ã‚ƒã†ã‹ã‚‰æ³¨æ„ï¼</td>
</tr>
<tr>
<td>learning_rate</td>
<td>0.1</td>
<td>å­¦ç¿’ç‡ï¼å°ã•ã„ã¨æ™‚é–“ã‹ã‹ã‚‹ã‘ã©å®‰å®šã™ã‚‹ã‚ˆï¼</td>
</tr>
</table>
</div>
<div class="code code-python">
# ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
params = {
    'objective': 'binary',  # äºŒå€¤åˆ†é¡ã ã‚ˆï¼
    'num_leaves': 5,       # è‘‰ã¯5æšã«åˆ¶é™ï¼
    'seed': 0,
    'verbose': -1
}
          </div>
</div>
</div>
<!-- SHAPã«ã‚ˆã‚‹è§£é‡ˆ -->
<div class="card">
<h2>ğŸ” SHAPã§äºˆæ¸¬ã‚’è§£é‡ˆã—ã¡ã‚ƒãŠï¼</h2>
<div class="feature">
<p>äºˆæ¸¬ã®ç†ç”±ã‚’è§£æ˜ã§ãã¡ã‚ƒã†è¶…ä¾¿åˆ©ãªSHAPï¼å„ç‰¹å¾´é‡ãŒã©ã‚Œãã‚‰ã„äºˆæ¸¬ã«è²¢çŒ®ã—ãŸã‹è¦‹ã¦ã¿ã‚ˆã†ï¼âœ¨</p>
<div class="code code-python">
# SHAPã§è§£é‡ˆ
explainer = shap.TreeExplainer(
    model,
    feature_perturbation = 'tree_path_dependent'
)
shap_values = explainer(X_test)

# å¯è¦–åŒ–
shap.plots.waterfall(shap_values[-3])
          </div>
<div class="tip">
<h4>ğŸ’« è§£é‡ˆã®ãƒã‚¤ãƒ³ãƒˆ</h4>
<ul>
<li>æ­£ã®å€¤ã¯äºˆæ¸¬ã‚’ä¸Šã’ã‚‹æ–¹å‘ã«åƒã„ãŸç‰¹å¾´é‡ï¼</li>
<li>è² ã®å€¤ã¯äºˆæ¸¬ã‚’ä¸‹ã’ã‚‹æ–¹å‘ã«åƒã„ãŸç‰¹å¾´é‡ï¼</li>
<li>æ£’ã®é•·ã•ãŒå½±éŸ¿ã®å¤§ãã•ã‚’è¡¨ã—ã¦ã‚‹ã‚ˆï¼</li>
</ul>
</div>
</div>
</div>
</div>

<a class="back-button" href="../index.html">
<span>â†</span> ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    </a>

<button class="sidebar-toggle" id="sidebarToggle">
<span>ğŸ“‘</span>
</button>
<div class="sidebar" id="sidebar">
<nav class="sidebar-content">
<a class="sidebar-item" href="1-1.html">1.1 äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«å…¥é–€ï¼âœ¨</a>
<a class="sidebar-item" href="1-2.html">1.2 æ©Ÿæ¢°å­¦ç¿’ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã‚ˆã†ï¼ğŸ®</a>
<a class="sidebar-item" href="1-3.html">1.3 ç’°å¢ƒæ§‹ç¯‰ã‚„ã£ã¦ã¿ã‚ˆï½ï¼ğŸŒˆ</a>
<a class="sidebar-item" href="2-1.html">2-1 ãƒ‡ãƒ¼ã‚¿åˆ†æã®ãƒ‡ã‚£ãƒ¼ãƒ—ãªä¸–ç•Œã¸ã‚ˆã†ã“ãï¼ğŸŒŸ</a>
<a class="sidebar-item" href="2-2.html">2.2 ç·šå½¢å›å¸°ã‚’ãƒã‚¹ã‚¿ãƒ¼ã—ã¡ã‚ƒãŠï¼ğŸŒˆ</a>
<a class="sidebar-item" href="2-3.html">2.3 å›å¸°æœ¨ã§äºˆæ¸¬åŠ›ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼ğŸŒŸ</a>
<a class="sidebar-item" href="2-4.html">2.4 LightGBMã§äºˆæ¸¬åŠ›ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆï¼ğŸš€</a>
<a class="sidebar-item" href="3-1.html">3.1 ãƒ‡ãƒ¼ã‚¿ç†è§£ãƒã‚¸æ¥µã‚ã¡ã‚ƒãŠï¼ğŸ‘©â€ğŸ’»âœ¨</a>
<a class="sidebar-item" href="3-2.html">3.2 ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°ã§ãƒã‚¸äºˆæ¸¬ï¼ğŸ‘©â€ğŸ’»âœ¨</a>
<a class="sidebar-item" href="3-3.html">3.3 LightGBMåˆ†é¡ã§ãƒã‚¸äºˆæ¸¬ï¼âœ¨</a>
<a class="sidebar-item" href="3-4.html">3.4 æ¤œè¨¼ãƒ‡ãƒ¼ã‚¿è©•ä¾¡ã§ãƒ¢ãƒ‡ãƒ«è¶…ãƒ‘ãƒ¯ãƒ¼ã‚¢ãƒƒãƒ—ï¼âœ¨</a>
</nav>
</div>
<script>
        document.getElementById("sidebarToggle").addEventListener("click", function() {
            const sidebar = document.getElementById("sidebar");
            sidebar.classList.toggle("open");
            this.classList.toggle("active");
        });
    </script>
</div>
</body>
</html>